{"version":3,"file":"couponModel.js","sources":["utils/couponModel.js"],"sourcesContent":["/**\r\n * 优惠券数据模型\r\n * 定义优惠券的数据结构和类型\r\n */\r\n\r\n// 优惠券类型枚举\r\nexport const COUPON_TYPES = {\r\n  DISCOUNT: 'discount', // 折扣券（如8折）\r\n  CASH: 'cash', // 现金券（如满50减10）\r\n  FREE: 'free', // 免单券\r\n  SPECIAL_PRICE: 'specialPrice', // 特价券（某商品固定价格）\r\n  SHIPPING: 'shipping' // 免运费券\r\n};\r\n\r\n// 优惠券使用范围\r\nexport const COUPON_SCOPES = {\r\n  ALL: 'all', // 全部商品\r\n  CATEGORY: 'category', // 特定分类\r\n  PRODUCT: 'product', // 特定商品\r\n  NEW_USER: 'newUser', // 新用户专享\r\n  MEMBER: 'member' // 会员专享\r\n};\r\n\r\n// 优惠券状态\r\nexport const COUPON_STATUS = {\r\n  VALID: 'valid', // 有效\r\n  USED: 'used', // 已使用\r\n  EXPIRED: 'expired', // 已过期\r\n  NOT_STARTED: 'notStarted' // 未开始\r\n};\r\n\r\n/**\r\n * 创建优惠券对象\r\n * @param {Object} couponData 优惠券数据\r\n * @returns {Object} 优惠券对象\r\n */\r\nexport const createCoupon = (couponData) => {\r\n  const now = Date.now();\r\n  \r\n  // 默认优惠券结构\r\n  const defaultCoupon = {\r\n    id: `coupon_${now}_${Math.floor(Math.random() * 1000000)}`, // 唯一ID\r\n    title: '默认优惠券', // 优惠券标题\r\n    type: COUPON_TYPES.DISCOUNT, // 优惠券类型\r\n    value: 0, // 优惠券面值或折扣率\r\n    minOrderAmount: 0, // 使用门槛（最低消费）\r\n    scope: COUPON_SCOPES.ALL, // 使用范围\r\n    scopeIds: [], // 适用的分类或商品ID\r\n    startTime: now, // 生效时间\r\n    endTime: now + 30 * 24 * 60 * 60 * 1000, // 失效时间（默认30天）\r\n    status: COUPON_STATUS.VALID, // 优惠券状态\r\n    description: '', // 使用说明\r\n    imageUrl: '/static/images/coupon1.png', // 优惠券图片\r\n    isDeleted: false, // 是否删除\r\n    createTime: now, // 创建时间\r\n    usedTime: null, // 使用时间\r\n    source: 'system' // 优惠券来源\r\n  };\r\n  \r\n  // 合并传入的数据\r\n  return { ...defaultCoupon, ...couponData };\r\n};\r\n\r\n/**\r\n * 计算优惠券状态\r\n * @param {Object} coupon 优惠券对象\r\n * @returns {String} 优惠券状态\r\n */\r\nexport const calculateCouponStatus = (coupon) => {\r\n  const now = Date.now();\r\n  \r\n  if (coupon.status === COUPON_STATUS.USED) {\r\n    return COUPON_STATUS.USED;\r\n  }\r\n  \r\n  if (now < coupon.startTime) {\r\n    return COUPON_STATUS.NOT_STARTED;\r\n  }\r\n  \r\n  if (now > coupon.endTime) {\r\n    return COUPON_STATUS.EXPIRED;\r\n  }\r\n  \r\n  return COUPON_STATUS.VALID;\r\n};\r\n\r\n/**\r\n * 创建特定类型的优惠券\r\n */\r\n\r\n// 创建折扣券\r\nexport const createDiscountCoupon = (discountRate, minOrderAmount = 0, options = {}) => {\r\n  return createCoupon({\r\n    type: COUPON_TYPES.DISCOUNT,\r\n    title: `${discountRate}折优惠券`,\r\n    value: discountRate, // 折扣率，例如8表示8折\r\n    minOrderAmount,\r\n    description: `满${minOrderAmount}元可用，${discountRate}折优惠`,\r\n    ...options\r\n  });\r\n};\r\n\r\n// 创建现金券\r\nexport const createCashCoupon = (amount, minOrderAmount = 0, options = {}) => {\r\n  return createCoupon({\r\n    type: COUPON_TYPES.CASH,\r\n    title: `${amount}元现金券`,\r\n    value: amount, // 优惠金额\r\n    minOrderAmount,\r\n    description: `满${minOrderAmount}元减${amount}元`,\r\n    ...options\r\n  });\r\n};\r\n\r\n// 创建免单券\r\nexport const createFreeCoupon = (maxAmount = 0, options = {}) => {\r\n  return createCoupon({\r\n    type: COUPON_TYPES.FREE,\r\n    title: '免单券',\r\n    value: maxAmount, // 最高免除金额，0表示无上限\r\n    description: maxAmount > 0 ? `最高免${maxAmount}元` : '免除订单金额',\r\n    ...options\r\n  });\r\n};\r\n\r\n// 创建特价券\r\nexport const createSpecialPriceCoupon = (productId, specialPrice, options = {}) => {\r\n  return createCoupon({\r\n    type: COUPON_TYPES.SPECIAL_PRICE,\r\n    title: '特价券',\r\n    value: specialPrice, // 特价金额\r\n    scope: COUPON_SCOPES.PRODUCT,\r\n    scopeIds: [productId],\r\n    description: `指定商品特价${specialPrice}元`,\r\n    ...options\r\n  });\r\n}; "],"names":[],"mappings":";AAMY,MAAC,eAAe;AAAA,EAC1B,UAAU;AAAA;AAAA,EACV,MAAM;AAAA;AAAA,EACN,MAAM;AAAA;AAAA,EACN,eAAe;AAAA;AAAA,EACf,UAAU;AAAA;AACZ;AAGO,MAAM,gBAAgB;AAAA,EAC3B,KAAK;AAAA;AAAA,EACL,UAAU;AAAA;AAAA,EACV,SAAS;AAAA;AAAA,EACT,UAAU;AAAA;AAAA,EACV,QAAQ;AAAA;AACV;AAGY,MAAC,gBAAgB;AAAA,EAC3B,OAAO;AAAA;AAAA,EACP,MAAM;AAAA;AAAA,EACN,SAAS;AAAA;AAAA,EACT,aAAa;AAAA;AACf;AAOO,MAAM,eAAe,CAAC,eAAe;AAC1C,QAAM,MAAM,KAAK;AAGjB,QAAM,gBAAgB;AAAA,IACpB,IAAI,UAAU,GAAG,IAAI,KAAK,MAAM,KAAK,WAAW,GAAO,CAAC;AAAA;AAAA,IACxD,OAAO;AAAA;AAAA,IACP,MAAM,aAAa;AAAA;AAAA,IACnB,OAAO;AAAA;AAAA,IACP,gBAAgB;AAAA;AAAA,IAChB,OAAO,cAAc;AAAA;AAAA,IACrB,UAAU,CAAE;AAAA;AAAA,IACZ,WAAW;AAAA;AAAA,IACX,SAAS,MAAM,KAAK,KAAK,KAAK,KAAK;AAAA;AAAA,IACnC,QAAQ,cAAc;AAAA;AAAA,IACtB,aAAa;AAAA;AAAA,IACb,UAAU;AAAA;AAAA,IACV,WAAW;AAAA;AAAA,IACX,YAAY;AAAA;AAAA,IACZ,UAAU;AAAA;AAAA,IACV,QAAQ;AAAA;AAAA,EACZ;AAGE,SAAO,EAAE,GAAG,eAAe,GAAG;AAChC;AAOY,MAAC,wBAAwB,CAAC,WAAW;AAC/C,QAAM,MAAM,KAAK;AAEjB,MAAI,OAAO,WAAW,cAAc,MAAM;AACxC,WAAO,cAAc;AAAA,EACtB;AAED,MAAI,MAAM,OAAO,WAAW;AAC1B,WAAO,cAAc;AAAA,EACtB;AAED,MAAI,MAAM,OAAO,SAAS;AACxB,WAAO,cAAc;AAAA,EACtB;AAED,SAAO,cAAc;AACvB;AAOY,MAAC,uBAAuB,CAAC,cAAc,iBAAiB,GAAG,UAAU,CAAA,MAAO;AACtF,SAAO,aAAa;AAAA,IAClB,MAAM,aAAa;AAAA,IACnB,OAAO,GAAG,YAAY;AAAA,IACtB,OAAO;AAAA;AAAA,IACP;AAAA,IACA,aAAa,IAAI,cAAc,OAAO,YAAY;AAAA,IAClD,GAAG;AAAA,EACP,CAAG;AACH;AAGY,MAAC,mBAAmB,CAAC,QAAQ,iBAAiB,GAAG,UAAU,CAAA,MAAO;AAC5E,SAAO,aAAa;AAAA,IAClB,MAAM,aAAa;AAAA,IACnB,OAAO,GAAG,MAAM;AAAA,IAChB,OAAO;AAAA;AAAA,IACP;AAAA,IACA,aAAa,IAAI,cAAc,KAAK,MAAM;AAAA,IAC1C,GAAG;AAAA,EACP,CAAG;AACH;AAGY,MAAC,mBAAmB,CAAC,YAAY,GAAG,UAAU,CAAA,MAAO;AAC/D,SAAO,aAAa;AAAA,IAClB,MAAM,aAAa;AAAA,IACnB,OAAO;AAAA,IACP,OAAO;AAAA;AAAA,IACP,aAAa,YAAY,IAAI,MAAM,SAAS,MAAM;AAAA,IAClD,GAAG;AAAA,EACP,CAAG;AACH;;;;;;;"}