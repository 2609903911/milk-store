{"version":3,"file":"userState.js","sources":["utils/userState.js"],"sourcesContent":["/**\r\n * 全局用户状态管理\r\n * 提供统一的用户信息访问和管理方式\r\n */\r\nimport { reactive } from 'vue';\r\nimport { getUserFromStorage } from './api/authApi';\r\nimport { createDefaultUserInfo } from './userModel';\r\n\r\n// 创建全局响应式用户状态对象\r\nexport const userState = reactive(createDefaultUserInfo());\r\n\r\n/**\r\n * 初始化用户状态\r\n * 从本地存储加载用户信息\r\n */\r\nexport const initUserState = async () => {\r\n  try {\r\n    // 从authApi中获取用户信息\r\n    const storedUserInfo = getUserFromStorage();\r\n    \r\n    if (storedUserInfo && storedUserInfo.userId) {\r\n      // TODO: 如果只有userId，需要从后端加载完整信息\r\n      // 可以在这里调用后端API获取完整的用户信息\r\n      \r\n      // 将存储的用户信息同步到响应式状态\r\n      Object.keys(userState).forEach(key => {\r\n        // 删除所有现有的属性（保持响应式）\r\n        delete userState[key];\r\n      });\r\n      \r\n      // 添加存储的用户ID\r\n      userState.userId = storedUserInfo.userId;\r\n      \r\n      console.log('已从本地存储加载用户ID');\r\n    } else {\r\n      console.log('未找到用户信息，使用默认值');\r\n    }\r\n    return true;\r\n  } catch (error) {\r\n    console.error('初始化用户状态失败', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * 更新用户状态\r\n * @param {Object} newInfo - 要更新的用户信息\r\n * @returns {Boolean} - 更新是否成功\r\n */\r\nexport const updateUserState = (newInfo) => {\r\n  try {\r\n    if (!newInfo || typeof newInfo !== 'object') {\r\n      return false;\r\n    }\r\n    \r\n    // 更新响应式状态\r\n    Object.assign(userState, newInfo);\r\n    \r\n    // 用户信息不再存储到本地，无需调用updateUserInfo\r\n    return true;\r\n  } catch (error) {\r\n    console.error('更新用户状态失败', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * 重置用户状态(同步到默认值)\r\n */\r\nexport const resetUserState = () => {\r\n  const defaultInfo = createDefaultUserInfo();\r\n  Object.assign(userState, defaultInfo);\r\n}; "],"names":["reactive","createDefaultUserInfo","getUserFromStorage","uni"],"mappings":";;;;AASY,MAAC,YAAYA,cAAAA,SAASC,gBAAAA,uBAAuB;AAM7C,MAAC,gBAAgB,YAAY;AACvC,MAAI;AAEF,UAAM,iBAAiBC,kBAAAA;AAEvB,QAAI,kBAAkB,eAAe,QAAQ;AAK3C,aAAO,KAAK,SAAS,EAAE,QAAQ,SAAO;AAEpC,eAAO,UAAU,GAAG;AAAA,MAC5B,CAAO;AAGD,gBAAU,SAAS,eAAe;AAElCC,oBAAAA,MAAY,MAAA,OAAA,4BAAA,cAAc;AAAA,IAChC,OAAW;AACLA,oBAAAA,MAAY,MAAA,OAAA,4BAAA,eAAe;AAAA,IAC5B;AACD,WAAO;AAAA,EACR,SAAQ,OAAO;AACdA,kBAAc,MAAA,MAAA,SAAA,4BAAA,aAAa,KAAK;AAChC,WAAO;AAAA,EACR;AACH;AAOY,MAAC,kBAAkB,CAAC,YAAY;AAC1C,MAAI;AACF,QAAI,CAAC,WAAW,OAAO,YAAY,UAAU;AAC3C,aAAO;AAAA,IACR;AAGD,WAAO,OAAO,WAAW,OAAO;AAGhC,WAAO;AAAA,EACR,SAAQ,OAAO;AACdA,kBAAA,MAAA,MAAA,SAAA,4BAAc,YAAY,KAAK;AAC/B,WAAO;AAAA,EACR;AACH;;;;"}