{"version":3,"file":"userState.js","sources":["utils/userState.js"],"sourcesContent":["/**\r\n * 全局用户状态管理\r\n * 提供统一的用户信息访问和管理方式\r\n */\r\nimport { reactive } from 'vue';\r\nimport { getUserInfo, updateUserInfo } from './userStorage';\r\nimport { createDefaultUserInfo } from './userModel';\r\n\r\n// 创建全局响应式用户状态对象\r\nexport const userState = reactive(createDefaultUserInfo());\r\n\r\n/**\r\n * 初始化用户状态\r\n * 从本地存储加载用户信息\r\n */\r\nexport const initUserState = () => {\r\n  try {\r\n    const storedUserInfo = getUserInfo();\r\n    if (storedUserInfo) {\r\n      // 将存储的用户信息同步到响应式状态\r\n      // 这里需要完全替换用户状态，而不是简单合并对象，以保证优惠券的状态等信息被完整保留\r\n      Object.keys(userState).forEach(key => {\r\n        // 删除所有现有的属性（保持响应式）\r\n        delete userState[key];\r\n      });\r\n      \r\n      // 添加存储的信息\r\n      Object.entries(storedUserInfo).forEach(([key, value]) => {\r\n        userState[key] = value;\r\n      });\r\n      \r\n      console.log('已从本地存储加载用户信息');\r\n    } else {\r\n      console.log('未找到用户信息，使用默认值');\r\n    }\r\n    return true;\r\n  } catch (error) {\r\n    console.error('初始化用户状态失败', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * 更新用户状态\r\n * @param {Object} newInfo - 要更新的用户信息\r\n * @returns {Boolean} - 更新是否成功\r\n */\r\nexport const updateUserState = (newInfo) => {\r\n  try {\r\n    if (!newInfo || typeof newInfo !== 'object') {\r\n      return false;\r\n    }\r\n    \r\n    // 更新响应式状态\r\n    Object.assign(userState, newInfo);\r\n    \r\n    // 同步到本地存储，确保完整更新用户信息\r\n    // 而不是仅更新部分字段\r\n    return updateUserInfo(userState);\r\n  } catch (error) {\r\n    console.error('更新用户状态失败', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * 重置用户状态(同步到默认值)\r\n */\r\nexport const resetUserState = () => {\r\n  const defaultInfo = createDefaultUserInfo();\r\n  Object.assign(userState, defaultInfo);\r\n  \r\n  // 清除本地存储的用户信息\r\n  updateUserInfo(defaultInfo);\r\n}; "],"names":["reactive","createDefaultUserInfo","getUserInfo","uni","updateUserInfo"],"mappings":";;;;AASY,MAAC,YAAYA,cAAAA,SAASC,gBAAAA,uBAAuB;AAM7C,MAAC,gBAAgB,MAAM;AACjC,MAAI;AACF,UAAM,iBAAiBC,kBAAAA;AACvB,QAAI,gBAAgB;AAGlB,aAAO,KAAK,SAAS,EAAE,QAAQ,SAAO;AAEpC,eAAO,UAAU,GAAG;AAAA,MAC5B,CAAO;AAGD,aAAO,QAAQ,cAAc,EAAE,QAAQ,CAAC,CAAC,KAAK,KAAK,MAAM;AACvD,kBAAU,GAAG,IAAI;AAAA,MACzB,CAAO;AAEDC,oBAAAA,MAAY,MAAA,OAAA,4BAAA,cAAc;AAAA,IAChC,OAAW;AACLA,oBAAAA,MAAY,MAAA,OAAA,4BAAA,eAAe;AAAA,IAC5B;AACD,WAAO;AAAA,EACR,SAAQ,OAAO;AACdA,kBAAc,MAAA,MAAA,SAAA,4BAAA,aAAa,KAAK;AAChC,WAAO;AAAA,EACR;AACH;AAOY,MAAC,kBAAkB,CAAC,YAAY;AAC1C,MAAI;AACF,QAAI,CAAC,WAAW,OAAO,YAAY,UAAU;AAC3C,aAAO;AAAA,IACR;AAGD,WAAO,OAAO,WAAW,OAAO;AAIhC,WAAOC,kBAAAA,eAAe,SAAS;AAAA,EAChC,SAAQ,OAAO;AACdD,kBAAA,MAAA,MAAA,SAAA,4BAAc,YAAY,KAAK;AAC/B,WAAO;AAAA,EACR;AACH;;;;"}