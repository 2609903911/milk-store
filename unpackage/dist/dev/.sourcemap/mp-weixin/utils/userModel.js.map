{"version":3,"file":"userModel.js","sources":["utils/userModel.js"],"sourcesContent":["/**\n * 用户信息模型\n * 定义用户信息的数据结构和默认值\n */\n\n/**\n * 创建默认用户信息\n * @returns {Object} 默认用户信息对象\n */\nexport const createDefaultUserInfo = () => {\n  // 当前时间戳\n  const now = Date.now();\n  \n  // 创建各类优惠券示例，方便测试\n  const exampleCoupons = [\n    // 1. 折扣券示例\n    {\n      id: `coupon_${now}_1`,\n      title: '奶茶8折券',\n      type: 'discount',\n      value: 8, // 8折\n      minOrderAmount: 30, // 最低消费30元\n      scope: 'all',\n      scopeIds: [],\n      startTime: now,\n      endTime: now + 30 * 24 * 60 * 60 * 1000, // 30天后过期\n      status: 'valid',\n      description: '满30元可用，全场通用8折优惠',\n      imageUrl: '/static/images/coupon1.png',\n      isDeleted: false,\n      createTime: now,\n      usedTime: null,\n      source: 'system'\n    },\n    \n    // 2. 现金券示例\n    {\n      id: `coupon_${now}_2`,\n      title: '满50减10元券',\n      type: 'cash',\n      value: 10, // 减10元\n      minOrderAmount: 50, // 最低消费50元\n      scope: 'all',\n      scopeIds: [],\n      startTime: now,\n      endTime: now + 15 * 24 * 60 * 60 * 1000, // 15天后过期\n      status: 'valid',\n      description: '满50元可用，立减10元',\n      imageUrl: '/static/images/coupon2.png',\n      isDeleted: false,\n      createTime: now,\n      usedTime: null,\n      source: 'newUser'\n    },\n    \n    // 3. 免单券示例\n    {\n      id: `coupon_${now}_3`,\n      title: '免单券',\n      type: 'free',\n      value: 50, // 最高优惠50元\n      minOrderAmount: 0, // 无最低消费\n      scope: 'all',\n      scopeIds: [],\n      startTime: now,\n      endTime: now + 7 * 24 * 60 * 60 * 1000, // 7天后过期\n      status: 'valid',\n      description: '满50元以下订单全额免单',\n      imageUrl: '/static/images/coupon3.png',\n      isDeleted: false,\n      createTime: now,\n      usedTime: null,\n      source: 'newUser'\n    },\n    \n    // 5. 特价券示例\n    {\n      id: `coupon_${now}_5`,\n      title: '杨梅吐气特价券',\n      type: 'specialPrice',\n      value: 9.9, // 特价9.9元\n      minOrderAmount: 0, // 无最低消费\n      scope: 'product',\n      scopeIds: ['杨梅吐气'], // 只适用于特定商品\n      startTime: now,\n      endTime: now + 10 * 24 * 60 * 60 * 1000, // 10天后过期\n      status: 'valid',\n      description: '杨梅吐气特价9.9元',\n      imageUrl: '/static/images/coupon5.png',\n      isDeleted: false,\n      createTime: now,\n      usedTime: null,\n      source: 'promotion'\n    },\n    \n    // 6. 免运费券示例\n    {\n      id: `coupon_${now}_6`,\n      title: '免运费券',\n      type: 'shipping',\n      value: 0, // 无金额属性\n      minOrderAmount: 20, // 最低消费20元\n      scope: 'all',\n      scopeIds: [],\n      startTime: now,\n      endTime: now + 30 * 24 * 60 * 60 * 1000, // 30天后过期\n      status: 'valid',\n      description: '满20元免除配送费',\n      imageUrl: '/static/images/coupon6.png',\n      isDeleted: false,\n      createTime: now,\n      usedTime: null,\n      source: 'delivery'\n    }\n  ];\n  \n  // 创建默认拥有的勋章\n  const defaultMedals = [\n    // 季节勋章\n    {\n      id: 'season_01',\n      name: '节气 · 立春',\n      icon: '/static/images/medal/season01.png',\n      type: 'seasonal',\n      isActive: true,\n      acquireTime: now - 60 * 24 * 60 * 60 * 1000,\n      description: '在立春节气期间下单获得'\n    },\n    {\n      id: 'season_02',\n      name: '节气 · 雨水',\n      icon: '/static/images/medal/season02.png',\n      type: 'seasonal',\n      isActive: true,\n      acquireTime: now - 45 * 24 * 60 * 60 * 1000,\n      description: '在雨水节气期间下单获得'\n    },\n    {\n      id: 'season_06',\n      name: '节气 · 谷雨',\n      icon: '/static/images/medal/season06.png',\n      type: 'seasonal',\n      isActive: true,\n      acquireTime: now - 20 * 24 * 60 * 60 * 1000,\n      description: '在谷雨节气期间下单获得'\n    },\n    {\n      id: 'season_08',\n      name: '节气 · 小满',\n      icon: '/static/images/medal/season08.png',\n      type: 'seasonal',\n      isActive: true,\n      acquireTime: now - 10 * 24 * 60 * 60 * 1000,\n      description: '在小满节气期间下单获得'\n    },\n    {\n      id: 'season_16',\n      name: '节气 · 秋分',\n      icon: '/static/images/medal/season16.png',\n      type: 'seasonal',\n      isActive: true,\n      acquireTime: now - 5 * 24 * 60 * 60 * 1000,\n      description: '在秋分节气期间下单获得'\n    },\n    {\n      id: 'season_19',\n      name: '节气 · 立冬',\n      icon: '/static/images/medal/season19.png',\n      type: 'seasonal',\n      isActive: true,\n      acquireTime: now - 2 * 24 * 60 * 60 * 1000,\n      description: '在立冬节气期间下单获得'\n    },\n    \n    // 大自然限定勋章\n    {\n      id: 'nature_bee',\n      name: '大自然 · 蜜蜂',\n      icon: '/static/images/medal/nature-bee.png',\n      type: 'nature',\n      isActive: true,\n      acquireTime: now - 30 * 24 * 60 * 60 * 1000,\n      description: '购买蜂蜜相关饮品获得'\n    },\n    {\n      id: 'nature_butterfly',\n      name: '大自然 · 蝴蝶',\n      icon: '/static/images/medal/nature-butterfly.png',\n      type: 'nature',\n      isActive: true,\n      acquireTime: now - 25 * 24 * 60 * 60 * 1000,\n      description: '夏季限定活动获得'\n    },\n    {\n      id: 'nature_cactus',\n      name: '大自然 · 仙人掌',\n      icon: '/static/images/medal/nature-cactus.png',\n      type: 'nature',\n      isActive: true,\n      acquireTime: now - 15 * 24 * 60 * 60 * 1000,\n      description: '沙漠主题活动获得'\n    },\n    \n    // 等级勋章\n    {\n      id: 'rank_01',\n      name: '等级 · Lv1',\n      icon: '/static/images/medal/rank01.png',\n      type: 'level',\n      isActive: true,\n      acquireTime: now - 90 * 24 * 60 * 60 * 1000,\n      description: '成为熊猫奶茶会员'\n    },\n    {\n      id: 'rank_02',\n      name: '等级 · Lv2',\n      icon: '/static/images/medal/rank02.png',\n      type: 'level',\n      isActive: true,\n      acquireTime: now - 75 * 24 * 60 * 60 * 1000,\n      description: '会员等级达到2级'\n    },\n    {\n      id: 'rank_03',\n      name: '等级 · Lv3',\n      icon: '/static/images/medal/rank03.png',\n      type: 'level',\n      isActive: true,\n      acquireTime: now - 50 * 24 * 60 * 60 * 1000,\n      description: '会员等级达到3级'\n    },\n    {\n      id: 'rank_04',\n      name: '等级 · Lv4',\n      icon: '/static/images/medal/rank04.png',\n      type: 'level',\n      isActive: true,\n      acquireTime: now - 30 * 24 * 60 * 60 * 1000,\n      description: '会员等级达到4级'\n    }\n  ];\n  \n  return {\n    userId: 'guest_' + Date.now(), // 用户唯一标识\n    nickname: '熊猫奶茶会员', // 用户昵称\n    avatar: '/static/images/avatar.png', // 头像地址\n    phone: '13027261672', // 手机号\n    gender: 'male', // 性别：male-男，female-女\n    birthday: '', // 生日，格式：YYYY-MM-DD\n    addresses: [], // 收货地址列表\n    pandaCoins: 856, // 熊猫币\n    coupons: exampleCoupons, // 优惠券列表，默认赠送六种不同类型的优惠券\n    medals: defaultMedals, // 勋章列表，默认赠送部分勋章\n    memberLevel: 4, // 会员等级\n    createTime: now, // 创建时间\n    lastLoginTime: now, // 最后登录时间\n  };\n};\n\n/**\n * 验证用户信息字段是否合法\n * @param {Object} userInfo - 用户信息对象\n * @returns {Boolean} 是否合法\n */\nexport const validateUserInfo = (userInfo) => {\n  if (!userInfo || typeof userInfo !== 'object') {\n    return false;\n  }\n  \n  // 基本字段类型验证\n  if (userInfo.userId && typeof userInfo.userId !== 'string') return false;\n  if (userInfo.nickname && typeof userInfo.nickname !== 'string') return false;\n  if (userInfo.phone && typeof userInfo.phone !== 'string') return false;\n  if (userInfo.pandaCoins !== undefined && typeof userInfo.pandaCoins !== 'number') return false;\n  if (userInfo.gender && !['male', 'female'].includes(userInfo.gender)) return false;\n  if (userInfo.birthday && typeof userInfo.birthday !== 'string') return false;\n  \n  // 数组类型验证\n  if (userInfo.coupons && !Array.isArray(userInfo.coupons)) return false;\n  if (userInfo.medals && !Array.isArray(userInfo.medals)) return false;\n  if (userInfo.addresses && !Array.isArray(userInfo.addresses)) return false;\n  \n  return true;\n};\n\n/**\n * 合并用户信息，使用默认值填充缺失字段\n * @param {Object} userInfo - 用户提供的信息\n * @returns {Object} 合并后的完整用户信息\n */\nexport const mergeWithDefaultUserInfo = (userInfo = {}) => {\n  const defaultInfo = createDefaultUserInfo();\n  return { ...defaultInfo, ...userInfo };\n};\n\n/**\n * 根据类型获取用户勋章\n * @param {Array} medals - 用户拥有的勋章数组\n * @param {String} type - 勋章类型：seasonal(季节), nature(大自然), level(等级)\n * @returns {Array} 指定类型的勋章数组\n */\nexport const getUserMedalsByType = (medals = [], type) => {\n  if (!Array.isArray(medals)) return [];\n  return medals.filter(medal => medal.type === type && medal.isActive);\n}; "],"names":[],"mappings":";AASY,MAAC,wBAAwB,MAAM;AAEzC,QAAM,MAAM,KAAK;AAGjB,QAAM,iBAAiB;AAAA;AAAA,IAErB;AAAA,MACE,IAAI,UAAU,GAAG;AAAA,MACjB,OAAO;AAAA,MACP,MAAM;AAAA,MACN,OAAO;AAAA;AAAA,MACP,gBAAgB;AAAA;AAAA,MAChB,OAAO;AAAA,MACP,UAAU,CAAE;AAAA,MACZ,WAAW;AAAA,MACX,SAAS,MAAM,KAAK,KAAK,KAAK,KAAK;AAAA;AAAA,MACnC,QAAQ;AAAA,MACR,aAAa;AAAA,MACb,UAAU;AAAA,MACV,WAAW;AAAA,MACX,YAAY;AAAA,MACZ,UAAU;AAAA,MACV,QAAQ;AAAA,IACT;AAAA;AAAA,IAGD;AAAA,MACE,IAAI,UAAU,GAAG;AAAA,MACjB,OAAO;AAAA,MACP,MAAM;AAAA,MACN,OAAO;AAAA;AAAA,MACP,gBAAgB;AAAA;AAAA,MAChB,OAAO;AAAA,MACP,UAAU,CAAE;AAAA,MACZ,WAAW;AAAA,MACX,SAAS,MAAM,KAAK,KAAK,KAAK,KAAK;AAAA;AAAA,MACnC,QAAQ;AAAA,MACR,aAAa;AAAA,MACb,UAAU;AAAA,MACV,WAAW;AAAA,MACX,YAAY;AAAA,MACZ,UAAU;AAAA,MACV,QAAQ;AAAA,IACT;AAAA;AAAA,IAGD;AAAA,MACE,IAAI,UAAU,GAAG;AAAA,MACjB,OAAO;AAAA,MACP,MAAM;AAAA,MACN,OAAO;AAAA;AAAA,MACP,gBAAgB;AAAA;AAAA,MAChB,OAAO;AAAA,MACP,UAAU,CAAE;AAAA,MACZ,WAAW;AAAA,MACX,SAAS,MAAM,IAAI,KAAK,KAAK,KAAK;AAAA;AAAA,MAClC,QAAQ;AAAA,MACR,aAAa;AAAA,MACb,UAAU;AAAA,MACV,WAAW;AAAA,MACX,YAAY;AAAA,MACZ,UAAU;AAAA,MACV,QAAQ;AAAA,IACT;AAAA;AAAA,IAGD;AAAA,MACE,IAAI,UAAU,GAAG;AAAA,MACjB,OAAO;AAAA,MACP,MAAM;AAAA,MACN,OAAO;AAAA;AAAA,MACP,gBAAgB;AAAA;AAAA,MAChB,OAAO;AAAA,MACP,UAAU,CAAC,MAAM;AAAA;AAAA,MACjB,WAAW;AAAA,MACX,SAAS,MAAM,KAAK,KAAK,KAAK,KAAK;AAAA;AAAA,MACnC,QAAQ;AAAA,MACR,aAAa;AAAA,MACb,UAAU;AAAA,MACV,WAAW;AAAA,MACX,YAAY;AAAA,MACZ,UAAU;AAAA,MACV,QAAQ;AAAA,IACT;AAAA;AAAA,IAGD;AAAA,MACE,IAAI,UAAU,GAAG;AAAA,MACjB,OAAO;AAAA,MACP,MAAM;AAAA,MACN,OAAO;AAAA;AAAA,MACP,gBAAgB;AAAA;AAAA,MAChB,OAAO;AAAA,MACP,UAAU,CAAE;AAAA,MACZ,WAAW;AAAA,MACX,SAAS,MAAM,KAAK,KAAK,KAAK,KAAK;AAAA;AAAA,MACnC,QAAQ;AAAA,MACR,aAAa;AAAA,MACb,UAAU;AAAA,MACV,WAAW;AAAA,MACX,YAAY;AAAA,MACZ,UAAU;AAAA,MACV,QAAQ;AAAA,IACT;AAAA,EACL;AAGE,QAAM,gBAAgB;AAAA;AAAA,IAEpB;AAAA,MACE,IAAI;AAAA,MACJ,MAAM;AAAA,MACN,MAAM;AAAA,MACN,MAAM;AAAA,MACN,UAAU;AAAA,MACV,aAAa,MAAM,KAAK,KAAK,KAAK,KAAK;AAAA,MACvC,aAAa;AAAA,IACd;AAAA,IACD;AAAA,MACE,IAAI;AAAA,MACJ,MAAM;AAAA,MACN,MAAM;AAAA,MACN,MAAM;AAAA,MACN,UAAU;AAAA,MACV,aAAa,MAAM,KAAK,KAAK,KAAK,KAAK;AAAA,MACvC,aAAa;AAAA,IACd;AAAA,IACD;AAAA,MACE,IAAI;AAAA,MACJ,MAAM;AAAA,MACN,MAAM;AAAA,MACN,MAAM;AAAA,MACN,UAAU;AAAA,MACV,aAAa,MAAM,KAAK,KAAK,KAAK,KAAK;AAAA,MACvC,aAAa;AAAA,IACd;AAAA,IACD;AAAA,MACE,IAAI;AAAA,MACJ,MAAM;AAAA,MACN,MAAM;AAAA,MACN,MAAM;AAAA,MACN,UAAU;AAAA,MACV,aAAa,MAAM,KAAK,KAAK,KAAK,KAAK;AAAA,MACvC,aAAa;AAAA,IACd;AAAA,IACD;AAAA,MACE,IAAI;AAAA,MACJ,MAAM;AAAA,MACN,MAAM;AAAA,MACN,MAAM;AAAA,MACN,UAAU;AAAA,MACV,aAAa,MAAM,IAAI,KAAK,KAAK,KAAK;AAAA,MACtC,aAAa;AAAA,IACd;AAAA,IACD;AAAA,MACE,IAAI;AAAA,MACJ,MAAM;AAAA,MACN,MAAM;AAAA,MACN,MAAM;AAAA,MACN,UAAU;AAAA,MACV,aAAa,MAAM,IAAI,KAAK,KAAK,KAAK;AAAA,MACtC,aAAa;AAAA,IACd;AAAA;AAAA,IAGD;AAAA,MACE,IAAI;AAAA,MACJ,MAAM;AAAA,MACN,MAAM;AAAA,MACN,MAAM;AAAA,MACN,UAAU;AAAA,MACV,aAAa,MAAM,KAAK,KAAK,KAAK,KAAK;AAAA,MACvC,aAAa;AAAA,IACd;AAAA,IACD;AAAA,MACE,IAAI;AAAA,MACJ,MAAM;AAAA,MACN,MAAM;AAAA,MACN,MAAM;AAAA,MACN,UAAU;AAAA,MACV,aAAa,MAAM,KAAK,KAAK,KAAK,KAAK;AAAA,MACvC,aAAa;AAAA,IACd;AAAA,IACD;AAAA,MACE,IAAI;AAAA,MACJ,MAAM;AAAA,MACN,MAAM;AAAA,MACN,MAAM;AAAA,MACN,UAAU;AAAA,MACV,aAAa,MAAM,KAAK,KAAK,KAAK,KAAK;AAAA,MACvC,aAAa;AAAA,IACd;AAAA;AAAA,IAGD;AAAA,MACE,IAAI;AAAA,MACJ,MAAM;AAAA,MACN,MAAM;AAAA,MACN,MAAM;AAAA,MACN,UAAU;AAAA,MACV,aAAa,MAAM,KAAK,KAAK,KAAK,KAAK;AAAA,MACvC,aAAa;AAAA,IACd;AAAA,IACD;AAAA,MACE,IAAI;AAAA,MACJ,MAAM;AAAA,MACN,MAAM;AAAA,MACN,MAAM;AAAA,MACN,UAAU;AAAA,MACV,aAAa,MAAM,KAAK,KAAK,KAAK,KAAK;AAAA,MACvC,aAAa;AAAA,IACd;AAAA,IACD;AAAA,MACE,IAAI;AAAA,MACJ,MAAM;AAAA,MACN,MAAM;AAAA,MACN,MAAM;AAAA,MACN,UAAU;AAAA,MACV,aAAa,MAAM,KAAK,KAAK,KAAK,KAAK;AAAA,MACvC,aAAa;AAAA,IACd;AAAA,IACD;AAAA,MACE,IAAI;AAAA,MACJ,MAAM;AAAA,MACN,MAAM;AAAA,MACN,MAAM;AAAA,MACN,UAAU;AAAA,MACV,aAAa,MAAM,KAAK,KAAK,KAAK,KAAK;AAAA,MACvC,aAAa;AAAA,IACd;AAAA,EACL;AAEE,SAAO;AAAA,IACL,QAAQ,WAAW,KAAK,IAAK;AAAA;AAAA,IAC7B,UAAU;AAAA;AAAA,IACV,QAAQ;AAAA;AAAA,IACR,OAAO;AAAA;AAAA,IACP,QAAQ;AAAA;AAAA,IACR,UAAU;AAAA;AAAA,IACV,WAAW,CAAE;AAAA;AAAA,IACb,YAAY;AAAA;AAAA,IACZ,SAAS;AAAA;AAAA,IACT,QAAQ;AAAA;AAAA,IACR,aAAa;AAAA;AAAA,IACb,YAAY;AAAA;AAAA,IACZ,eAAe;AAAA;AAAA,EACnB;AACA;AAiCY,MAAC,2BAA2B,CAAC,WAAW,OAAO;AACzD,QAAM,cAAc;AACpB,SAAO,EAAE,GAAG,aAAa,GAAG;AAC9B;AAQY,MAAC,sBAAsB,CAAC,SAAS,CAAE,GAAE,SAAS;AACxD,MAAI,CAAC,MAAM,QAAQ,MAAM;AAAG,WAAO,CAAA;AACnC,SAAO,OAAO,OAAO,WAAS,MAAM,SAAS,QAAQ,MAAM,QAAQ;AACrE;;;;"}