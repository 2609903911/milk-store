{"version":3,"file":"userData.js","sources":["utils/userData.js"],"sourcesContent":["/**\r\n * 用户数据管理模块\r\n * 从本地存储获取后端返回的用户数据\r\n */\r\nimport { reactive } from 'vue';\r\nimport { getUserFromStorage } from './api/authApi';\r\n\r\n// 创建默认用户数据对象\r\nconst createDefaultUserData = () => {\r\n    return {\r\n        userId: '',\r\n        nickname: '游客',\r\n        avatar: '/static/images/avatar.png',\r\n        phone: '',\r\n        gender: 'unknown',\r\n        birthday: null,\r\n        pandaCoins: 0,\r\n        lightningStars: 0,\r\n        memberLevel: 1,\r\n        createTime: null,\r\n        lastLoginTime: null,\r\n        medals: [],\r\n        coupons: [],\r\n        addresses: []\r\n    };\r\n};\r\n\r\n// 创建响应式用户数据对象\r\nexport const userData = reactive(createDefaultUserData());\r\n\r\n// 初始化用户数据\r\nexport const initUserData = () => {\r\n    try {\r\n        // 从本地存储获取用户数据\r\n        const storedUserData = getUserFromStorage();\r\n        \r\n        if (storedUserData) {\r\n            // 将存储的用户数据同步到响应式对象\r\n            Object.keys(userData).forEach(key => {\r\n                // 删除所有现有的属性（保持响应式）\r\n                delete userData[key];\r\n            });\r\n            \r\n            // 添加存储的信息\r\n            Object.entries(storedUserData).forEach(([key, value]) => {\r\n                userData[key] = value;\r\n            });\r\n            \r\n            console.log('已从本地存储加载用户数据');\r\n            return true;\r\n        } else {\r\n            console.log('未找到用户数据，使用默认值');\r\n            return false;\r\n        }\r\n    } catch (error) {\r\n        console.error('初始化用户数据失败', error);\r\n        return false;\r\n    }\r\n};\r\n\r\n// 检查用户是否已登录\r\nexport const isLoggedIn = () => {\r\n    return !!userData.userId;\r\n}; "],"names":["reactive","getUserFromStorage","uni"],"mappings":";;;AAQA,MAAM,wBAAwB,MAAM;AAChC,SAAO;AAAA,IACH,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,gBAAgB;AAAA,IAChB,aAAa;AAAA,IACb,YAAY;AAAA,IACZ,eAAe;AAAA,IACf,QAAQ,CAAE;AAAA,IACV,SAAS,CAAE;AAAA,IACX,WAAW,CAAE;AAAA,EACrB;AACA;AAGY,MAAC,WAAWA,cAAAA,SAAS,uBAAuB;AAG5C,MAAC,eAAe,MAAM;AAC9B,MAAI;AAEA,UAAM,iBAAiBC,kBAAAA;AAEvB,QAAI,gBAAgB;AAEhB,aAAO,KAAK,QAAQ,EAAE,QAAQ,SAAO;AAEjC,eAAO,SAAS,GAAG;AAAA,MACnC,CAAa;AAGD,aAAO,QAAQ,cAAc,EAAE,QAAQ,CAAC,CAAC,KAAK,KAAK,MAAM;AACrD,iBAAS,GAAG,IAAI;AAAA,MAChC,CAAa;AAEDC,oBAAAA,MAAA,MAAA,OAAA,2BAAY,cAAc;AAC1B,aAAO;AAAA,IACnB,OAAe;AACHA,oBAAAA,MAAA,MAAA,OAAA,2BAAY,eAAe;AAC3B,aAAO;AAAA,IACV;AAAA,EACJ,SAAQ,OAAO;AACZA,kBAAA,MAAA,MAAA,SAAA,2BAAc,aAAa,KAAK;AAChC,WAAO;AAAA,EACV;AACL;;;"}